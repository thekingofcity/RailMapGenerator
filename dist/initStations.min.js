(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{20:function(e,t,n){"use strict";n.r(t),n.d(t,"common",(function(){return f}));var i=n(0),a=n(2),l=n(3),d=n(13),s=n(12),o=n(8),c=n(22),r=n(4),_=n(14),p=n(16);const h=(e,t,n)=>$("<div>",{id:e,class:"mdc-chip",role:"row"}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{class:"mdc-chip__icon mdc-chip__icon--leading"}).text(n).css("display","gzmtr"===window.urlParams.get("style")?"block":"none")).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).append($("<span>",{class:"stn-chip__text stn-chip__text--zh"}).text(t[0])).append($("<span>",{class:"stn-chip__text stn-chip__text--en"}).html(t[1].split("\\").join("<br>")))))[0],m=e=>$("<div>",{class:"mdc-chip",role:"row"}).css({"background-color":e[a.b.colour],color:e[a.b.fg]}).data("theme",{city:e[a.b.city],line:e[a.b.line]}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).html(e[a.b.nameZH]+"<br>"+e[a.b.nameEN]))).append($("<span>",{role:"gridcell"}).append($("<i>",{class:"material-icons mdc-chip__icon mdc-chip__icon--trailing",tabindex:-1,role:"button"}).text("cancel")))[0],u=e=>{let t,n=e.map(e=>$(e).find(".mdc-chip").get().map(e=>{return t=e,[$(t).data("theme").city,$(t).data("theme").line,Object(i.j)($(t).css("background-color")),Object(i.j)($(t).css("color")),$(t).find(".mdc-chip__text").html().split("<br>")[0],$(t).find(".mdc-chip__text").html().split("<br>")[1]];var t})),a=n.map(e=>e.length);return 0===a[1]&&(n=[n[0]]),t=3===a[0]&&0===a[1]?"int3":2===a[0]&&1===a[1]?"osi31":2===a[0]&&0===a[1]?"int3":1===a[0]&&2===a[1]?"osi22":1===a[0]&&1===a[1]?"osi21":1===a[0]&&0===a[1]?"int2":0===a[0]&&3===a[1]?"osi13":0===a[0]&&2===a[1]?"osi12":0===a[0]&&1===a[1]?"osi11":0===a[0]&&0===a[1]?"none":"int3",console.log(t),{info:n,changeType:t}},g=(e,t,n)=>{let i,{changeType:a,info:l}=u(e),d=l,s=$("#stn_edit_diag").attr("for");if(-1!==a.indexOf("osi")){let e=$("button#osi_name .mdc-button__label").html().split("<br>");d[1].unshift(e)}i=t.selectedChipIds.length?t.selectedChipIds[0]:"r";let o=n.checked;-1!==a.indexOf("osi")?a+="_"+(o?"p":"u")+i:-1!==a.indexOf("int3")&&(a+="_"+i),window.myLine.updateStnTransfer(s,a,d)};function f(){const e=$("#stn_list")[0],t=new c.a(e),n=new p.MDCSnackbar($("#panel_stations .mdc-snackbar")[0]),[u,f,b,v,w,x]=["#stn_add_diag","#stn_edit_diag","#stn_intbox_diag","#stn_osiname_diag","#stn_delete_diag","#stn_delete_err"].map(e=>new l.MDCDialog($(e)[0])),[C,D,y,I]=["#prep","#pivot","#loc","#end"].map(e=>new d.MDCSelect($("#stn_add_diag").find(e)[0])),M=$("#stn_edit_diag #panel_name .mdc-chip-set")[0],j=new c.a(M),k=["#name_zh","#name_en"].map(e=>new s.MDCTextField($("#stn_edit_diag").find(e)[0])),S=new s.MDCTextField($("#stn_edit_diag #stn_num")[0]),E=$("#stn_edit_diag .mdc-icon-button").get(),O=$("#stn_edit_diag #panel_interchange .mdc-chip-set.int-chip-set").get(),L=O.map(e=>new c.a(e)),[T,z,P]=(new r.MDCRipple($("#stn_edit_diag #osi_name")[0]),["#int_city","#int_line","#int_fg"].map(e=>new d.MDCSelect($(e)[0]))),[F,B]=["#int_colour","#int_colour_hex"].map(e=>new s.MDCTextField($(e)[0])),N=["zh","en"].map(e=>new s.MDCTextField($("#stn_intbox_diag").find("#name_"+e)[0])),q=new c.a($("#tick_direc")[0]),A=new _.MDCSwitch($("#paid_area")[0]),J=new o.MDCTabBar($("#stn_edit_diag .mdc-tab-bar")[0]),U=["zh","en"].map(e=>new s.MDCTextField($("#stn_osiname_diag").find(`#osi_name_${e}`)[0])),[H,R,Z]=["through","first","pos"].map(e=>["left","right"].map(t=>new d.MDCSelect($(`#${t}_${e}`)[0])));let G=Object(i.d)().stn_list;window.myLine.tpo.forEach(n=>{let i=h(n,G[n].name,G[n].num);e.appendChild(i),t.addChip(i),$("#pivot__selection").append($("<li>",{"data-value":n}).addClass("mdc-list-item").text("gzmtr"===window.urlParams.get("style")?`${G[n].num}: ${G[n].name.join()}`:G[n].name.join()))}),t.listen("MDCChip:selection",e=>{e.detail.selected?"add_stn"!==e.detail.chipId?n.open():u.open():n.close()}),n.listen("MDCSnackbar:opening",()=>{let e=Object(i.d)().stn_list[t.selectedChipIds[0]];"gzmtr"===window.urlParams.get("style")?n.labelText=`${e.num}: ${e.name.join()}`:n.labelText=`${e.name.join()}`}),n.listen("MDCSnackbar:closed",e=>{e.detail.reason&&(t.chips.filter(e=>t.selectedChipIds.includes(e.id))[0].selected=!1)}),$("#panel_stations .mdc-snackbar button#current").on("click",()=>{window.myLine.currentStnId=t.selectedChipIds[0]}),$("#panel_stations .mdc-snackbar button#edit").on("click",()=>{$("#stn_edit_diag").attr("for",t.selectedChipIds[0]),f.open()}),$("#panel_stations .mdc-snackbar button#remove").on("click",()=>{$("#stn_delete_diag").attr("for",t.selectedChipIds[0]),w.open()}),u.listen("MDCDialog:opening",()=>{D.selectedIndex=0}),u.listen("MDCDialog:opened",()=>{[C,D,y].forEach(e=>e.layout())}),u.listen("MDCDialog:closed",n=>{if(t.chips.filter(e=>t.selectedChipIds.includes(e.id))[0].selected=!1,"close"===n.detail.action)return;let i=C.value,a=D.value,l=y.value,d=I.value;console.log(i,a,l,d);let[s,o]=window.myLine.addStn(i,a,l,d),c=window.myLine.tpo,r=c[c.indexOf(s)-1]||"add_stn",_=h(s,o.name,o.num);$(e).find("#"+r).after(_),t.addChip(_);var p=$("<li>",{"data-value":s,class:"mdc-list-item"}).text(o.name.join(" - "));"add_stn"==r?$("#pivot__selection").prepend(p):$(`#pivot__selection [data-value="${r}"`).after(p),$("#stn_edit_diag").attr("for",s),f.open()}),C.listen("MDCSelect:change",e=>{$("#stn_add_diag #pivot")[0].dispatchEvent(new Event("MDCSelect:change"))}),D.listen("MDCSelect:change",e=>{var t=C.value,n=D.value,a=Object(i.d)().stn_list;for(let[e,i]of window.myLine.newStnPossibleLoc(t,n).entries())1===i||i.length?($("#loc__selection li").eq(e).show(),e>=3&&($("#end__selection").empty(),i.forEach(e=>{$("#end__selection").append($("<li>",{class:"mdc-list-item","data-value":e}).text(a[e].name.join(" - ")))}))):$("#loc__selection li").eq(e).hide();y.value=Array.from(document.querySelectorAll("#loc__selection li")).filter(e=>"none"!==e.style.display)[0].dataset.value}),y.listen("MDCSelect:change",e=>{["newupper","newlower"].includes(e.detail.value)?($("#stn_add_diag [new-branch]").show(),I.selectedIndex=0):$("#stn_add_diag [new-branch]").hide()}),$("#stn_edit_diag").find("#name_zh, #name_en, #stn_num").on("input",()=>{let t=k.map(e=>e.value);var n=S.value,i=$("#stn_edit_diag").attr("for");window.myLine.updateStnName(i,t,n),$(e).find("#"+i).find(".mdc-chip__icon--leading").text(n),$(e).find("#"+i).find(".stn-chip__text--zh").text(t[0]),$(e).find("#"+i).find(".stn-chip__text--en").html(t[1].split("\\").join("<br>")),$(`li[data-value="${i}`).text("gzmtr"===window.urlParams.get("style")?`${G[i].num}: ${G[i].name.join()}`:G[i].name.join())});const K=()=>{k.map(e=>e.layout()),S.layout()},Q=()=>{U.forEach(e=>e.layout())},V=()=>{[...H,...R,...Z].map(e=>e.layout())};J.listen("MDCTabBar:activated",e=>{switch(e.detail.index){case 0:$("#panel_name").show(),$("#panel_interchange, #panel_branch").hide(),K();break;case 1:$("#panel_interchange").show(),$("#panel_name, #panel_branch").hide(),Q();break;case 2:$("#panel_name, #panel_interchange").hide(),$("#panel_branch").show(),V()}}),$.getJSON("data/city_list.json",e=>{var t=window.urlParams.get("lang");e.forEach(e=>{$("#int_city__selection.mdc-list").each((n,a)=>{$(a).append($("<li>",{class:"mdc-list-item","data-value":e.id}).html(Object(i.a)(e.country)+Object(i.f)(e.name,t)))})})}),f.listen("MDCDialog:opening",e=>{let t=$(e.target).attr("for"),n=Object(i.d)().stn_list[t];(e=>{k.forEach((t,n)=>t.value=e.name[n]),S.value=e.num,j.chips.forEach(t=>{t.selected=e.services.includes(t.id)})})(n),(e=>{$(O).empty(),e.transfer.info.forEach((e,t)=>{e.forEach((e,n)=>{let i=m(e);O[t].appendChild(i),L[t].addChip(i)})}),e.transfer.osi_names.length?$("button#osi_name .mdc-button__label").html(e.transfer.osi_names[0].join("<br>")):$("button#osi_name .mdc-button__label").html("車站名<br>Stn Name"),A.checked=e.transfer.paid_area,q.chips.filter(t=>t.id===e.transfer.tick_direc)[0].selected=!0})(n),(e=>{["left","right"].forEach(t=>{let n=e.branch[t][0];n?(H[a.a[t]].value=n,$(`#${t}_through__selection [data-value="na"]`).hide(),$(`#${t}_through__selection [data-value="through"]`).show(),$(`#${t}_through__selection [data-value="nonthrough"]`).show(),$(`[${t}-first-group], [${t}-pos-group]`).show()):(H[a.a[t]].value="na",$(`#${t}_through__selection [data-value="na"]`).show(),$(`#${t}_through__selection [data-value="through"]`).hide(),$(`#${t}_through__selection [data-value="nonthrough"]`).hide(),$(`[${t}-first-group], [${t}-pos-group]`).hide())}),$("#left_first__selection, #right_first__selection").empty(),Promise.resolve(Object(i.d)().stn_list).then(t=>{[0,1].forEach(n=>{e[a.c[n]].forEach(e=>{$(`#${a.a[n]}_first__selection`).append($("<li>",{class:"mdc-list-item","data-value":e}).text(t[e].name.join()))})})}).then(()=>{H.forEach((t,n)=>{R[n].selectedIndex="na"!==t.value?e[a.c[n]].indexOf(e.branch[a.a[n]][1]):0})}),Z.forEach((t,n)=>{t.selectedIndex=e[a.c[n]].indexOf(e.branch[a.a[n]][1])})})(n)}),f.listen("MDCDialog:opened",e=>{K(),Q(),V()}),j.listen("MDCChip:selection",e=>{if("local"===e.detail.chipId)return void(e.detail.selected||(j.chips.filter(e=>"local"===e.id)[0].selected=!0));let t=$("#stn_edit_diag").attr("for");window.myLine.updateStnServices(t,e.detail)}),E.forEach((e,t)=>{$(e).on("click",e=>{let n=[Object(i.d)().theme[0],null,null,"#000","線","Line"],a=m(n);O[t].appendChild(a),L[t].addChip(a),g(O,q,A)})}),L.forEach((e,t)=>{e.listen("MDCChip:interaction",e=>{$("#stn_intbox_diag").data("intId",{setIdx:t,chipId:e.detail.chipId}),b.open()})}),L.forEach((e,t)=>{e.listen("MDCChip:removal",()=>{g(O,q,A)})}),$("button#osi_name").on("click",e=>{v.open()}),b.listen("MDCDialog:opening",e=>{let{setIdx:t,chipId:n}=$(e.target).data("intId"),{city:i,line:a}=$(O[t]).find("#"+n).data("theme");T.value=i;let l=$(O[t]).find("#"+n).find(".mdc-chip__text").html().split("<br>");N.forEach((e,t)=>e.value=l[t])}),b.listen("MDCDialog:opened",e=>{N.map(e=>e.layout()),F.layout(),B.layout(),P.layout()}),T.listen("MDCSelect:change",e=>{if(-1===e.detail.index)return;let t=e.detail.value;"other"===t?($("[int-line]").hide(),$("[int-diy]").show()):($("[int-line]").show(),$("[int-diy]").hide());let{setIdx:n,chipId:a}=$("#stn_intbox_diag").data("intId");$.getJSON(`data/${e.detail.value}.json`,e=>{var l=window.urlParams.get("lang");$("#int_line__selection.mdc-list").empty(),e.forEach(e=>{$("#int_line__selection.mdc-list").append($("<li>",{class:"mdc-list-item","data-value":e.id}).append($("<span>").css({background:"other"===t?$(O[n]).find("#"+a).css("background-color"):e.colour,color:"other"===t?$(O[n]).find("#"+a).css("color"):e.fg||"#fff"}).text(" "+Object(i.f)(e.name,l)+" ")))});let{line:d}=$(O[n]).find("#"+a).data("theme"),s=$("#int_line__selection.mdc-list").find(`[data-value="${d}"]`).index();z.selectedIndex=-1===s?0:s}),$(O[n]).find("#"+a).data("theme").city=e.detail.value}),z.listen("MDCSelect:change",e=>{let{value:t,index:n}=e.detail,{setIdx:a,chipId:l}=$("#stn_intbox_diag").data("intId"),d=["background-color","color"].map(e=>$("#int_line__selection span").eq(n).css(e)).map(i.j);F.value=d[0],B.value=d[0].slice(1).toUpperCase(),P.value=d[1],$(O[a]).find("#"+l).data("theme").line=t,$(O[a]).find("#"+l).css({"background-color":d[0],color:d[1]})}),$(F.root_).find("input").on("input",e=>{let t=e.target.value;B.value=t.slice(1).toUpperCase();let{setIdx:n,chipId:i}=$("#stn_intbox_diag").data("intId");$(O[n]).find("#"+i).css({"background-color":t}),$("#int_line__selection li span").css("background",t)}),$(B.root_).find("input").on("input",e=>{let t=e.target.value;if(null===t.match(/[0-9a-fA-F]{6}/g))return;if(t!==t.match(/[0-9a-fA-F]{6}/g)[0])return;F.value="#"+t;let{setIdx:n,chipId:i}=$("#stn_intbox_diag").data("intId");$(O[n]).find("#"+i).css({"background-color":"#"+t}),$("#int_line__selection li span").css("background","#"+t)}),P.listen("MDCSelect:change",e=>{if("other"!==T.value)return;let{setIdx:t,chipId:n}=$("#stn_intbox_diag").data("intId");$(O[t]).find("#"+n).css({color:e.detail.value}),$("#int_line__selection li span").css("color",e.detail.value)}),N.forEach(e=>{$(e.root_).find("input").on("input",()=>{let{setIdx:e,chipId:t}=$("#stn_intbox_diag").data("intId");$(O[e]).find("#"+t).find(".mdc-chip__text").html(N[0].value+"<br>"+N[1].value)})}),b.listen("MDCDialog:closed",()=>{g(O,q,A)}),v.listen("MDCDialog:opening",()=>{$("button#osi_name .mdc-button__label").html().split("<br>").forEach((e,t)=>U[t].value=e)}),v.listen("MDCDialog:opened",()=>{U.map(e=>e.layout())}),$("#osi_name_zh, #osi_name_en").find("input").each((e,t)=>{$(t).on("input",()=>{$("button#osi_name .mdc-button__label").html(U.map(e=>e.value).join("<br>"))})}),v.listen("MDCDialog:closed",()=>{g(O,q,A)}),q.listen("MDCChip:selection",e=>{0!==q.selectedChipIds.length&&g(O,q,A)}),$(A.root_).find("input").on("change",()=>{g(O,q,A)}),H.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===e.detail.value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchType(n,t,e.detail.value)})}),R.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if(1===$(`#${a.a[t]}_first__selection`).children().length)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchFirst(n,t,e.detail.value)&&(Z[t].selectedIndex=0===Z[t].selectedIndex?1:0)})}),Z.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===H[t].value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchPos(n,t,e.detail.index)})}),w.listen("MDCDialog:opening",e=>{var t=$(e.target).attr("for");$("#stn_delete_diag #err_stn").text(Object(i.d)().stn_list[t].name.join(" - "))}),w.listen("MDCDialog:closed",e=>{if("close"!=e.detail.action){var n=$(e.target).attr("for");window.myLine.removeStn(n)?(t.chips.filter(e=>e.id===n)[0].beginExit(),$(`#pivot__selection [data-value="${n}"]`).remove()):x.open()}})}}}]);